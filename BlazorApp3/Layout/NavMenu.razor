@inject NavigationManager Nav
@inject BlazorApp3.Services.BcvAuthStateProvider AuthState
@inject IJSRuntime JS

<nav class="bcv-nav">
    <div class="bcv-nav-inner">
        <a href="/" class="bcv-nav-brand">Beers Cheers & Vasis</a>

        <button class="bcv-nav-toggle" @onclick="ToggleMenu">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <ul class="bcv-nav-links @(menuOpen ? "open" : "")">
            <li><NavLink href="/" Match="NavLinkMatch.All">Home</NavLink></li>
            <li><NavLink href="/read">Read</NavLink></li>
            <AuthorizeView>
                <Authorized>
                    <li><NavLink href="/admin">Admin</NavLink></li>
                    <li><a href="javascript:void(0)" @onclick="Logout" style="cursor:pointer;">Sign Out</a></li>
                </Authorized>
                <NotAuthorized>
                    <li><NavLink href="/login">Sign In</NavLink></li>
                </NotAuthorized>
            </AuthorizeView>
            <li>
                <a href="javascript:void(0)" @onclick="ToggleTheme" style="cursor:pointer; font-size:1.2rem;" title="Toggle dark mode">
                    @(_isDark ? "‚òÄÔ∏è" : "üåô")
                </a>
            </li>
        </ul>
    </div>
</nav>

@code {
    private bool menuOpen;
    private bool _isDark;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;
        var theme = await JS.InvokeAsync<string>("localStorage.getItem", "bcv-theme");
        _isDark = theme != "light";
        await JS.InvokeVoidAsync("eval", $"document.documentElement.setAttribute('data-theme','{(_isDark ? "dark" : "light")}')");
        StateHasChanged();
    }

    private void ToggleMenu() => menuOpen = !menuOpen;

    private async Task ToggleTheme()
    {
        _isDark = !_isDark;
        var theme = _isDark ? "dark" : "light";
        await JS.InvokeVoidAsync("eval", $"document.documentElement.setAttribute('data-theme','{theme}');localStorage.setItem('bcv-theme','{theme}')");
    }

    private async Task Logout()
    {
        await AuthState.LogoutAsync();
        Nav.NavigateTo("/");
    }
}
